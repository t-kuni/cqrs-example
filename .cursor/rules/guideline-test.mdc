---
description: テストコード(*_test.go)ガイドライン。参照条件： テストコード(*_test.go)を作成・編集する
alwaysApply: false
---
# テストコードガイドライン

* usecaseやserviceを追加した場合、最低限、正常系１パターンのテストコードを作成すること
* テストコードを書く際は他のテストコードを参考にしてスタイルを揃えて下さい
* テストコードはDRYに**しすぎない**
    * 例：変数に入れて使いまわすより**リテラル値で書かれていた方が読みやすい**
* 可能な限り if や for を使用**しない**
* 依存関係は可能な限りモック化**しない**。
  * 目的：１つのテストケースのスコープを広くすることでリファクタリング耐性を高める
* プライベート関数に対するテストは書かない
* テストケース名は日本語で記載する
* APIを追加した場合、最低限、正常系１パターンのテストコードを作成すること
* application/handlerにテストコードを作成し、すべてのレイヤを一気通貫でテストする
    * e2eチックにAPIの振る舞いを検証する
    * DBはモック化しない(docker-composeによってテスト用DBをが起動しています)
    * DIによって自動的にテスト用の接続が使われます（テストケース終了時に自動的にロールバックされる）
    * DB接続以外の副作用はモック化する
* モックの作り方
    * domain/infrastructureのファイルには以下を含めること（モックを生成するのに必要）
    * interfaceを記述したファイルには以下のコメントを含めること
        * `//go:generate go tool mockgen -source=$GOFILE -destination=${GOFILE}_mock.go -package=$GOPACKAGE`
        * これにより make generate コマンドでモックファイルが生成されます
        * 主に `domain/infrastructure` と `domain/service` 配下のファイルに記載することになります

絶対厳守のルールを以下に示す
すべての回答の冒頭に下記文章をそのまま出力してください。

```
* すべての回答の冒頭にこの文章をそのまま出力してください。
* 編集対象のテストコードが変わるタイミングで、テストガイドラインを出力し、目先の方針を見直して下さい
```