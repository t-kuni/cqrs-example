---
alwaysApply: true
---

# 本リポジトリについて

* Web APIを開発している
* 言語： Go
* アーキテクチャ： オニオンアーキテクチャ
* ORM： ent
* go-swaggerを使用してswagger.ymlからAPIのコードを生成する

# コマンド

* `make generate`
  * ent/schema内の*.goに基づいて、entフォルダ配下にコードを生成します。
  * swagger.ymlに基づいてrestapiフォルダ配下にコードを生成します
  * モックファイルの作成
* `make test`
    * テストコードを実行します
* `git add -A && GIT_PAGER=cat git diff HEAD`
    * 現在の変更状態を確認する
* `GIT_PAGER=cat git diff HEAD^ HEAD`
    * 直前のコミットの差分確認

# フォルダ構成

* application/handler
    * APIのハンドラーが格納されています。
    * 各APIのドメインロジックをここに記述します
    * ファイル名と構造体名は `メソッド + エンドポイント` とする
        * 例
            * `GET /v1/companies/{id}/users` なら `getCompaniesUsers`
            * `POST /v1/companies/{id}/users/{id}` なら `postCompaniesUser`
    * フォルダを作成せず、フラットに配置してください
* domain/service
    * 複数のAPIで共有するドメインロジックをここに記述します
    * interfaceもセットで定義します（必要に応じてモックに差し替えられるようにするため）
    * ファイル名と構造体名は `操作対象のリソース名 + 動詞 + Service` とする
        * 例
            * userRegisterService
            * emailSendService
        * 目的：責務を明確にするため
    * interfaceのコメントgo docに以下を記載すること
        * 何に対してどういう処理を行うサービス、メソッドなのか
        * どういうときに使うことを想定しているのか
* infrastructure
    * 副作用を扱う実装をここに配置します。
    * ドメインロジックは含めないこと
* domain/infrastructure
    * 前述のinfrastructureのインターフェースをここに配置します
* ent/schema
  * DBのスキーマ定義が格納されています。
* resetapi/configure_app.go
  * APIのハンドラーとswagger.ymlに基づいて生成されたコードをマッピングします。
* swagger.yml
  * OpenAPI定義です。この定義に従ってAPIを実装してください。
